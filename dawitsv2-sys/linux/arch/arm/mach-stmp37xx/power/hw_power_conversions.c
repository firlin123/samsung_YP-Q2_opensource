////////////////////////////////////////////////////////////////////////////////
//! \addtogroup hw_power
//! @{
//
// Copyright (c) 2004 - 2007 SigmaTel, Inc.
//
//! \file hw_power_conversions.c
//! \brief Contains functions to convert mV or mA values to register settings
//!
//! \version 0.1
//! \date 03/2007
//!
//! This file contains the conversion functions to convert mA to register settings,
//! and to convert mV values to register settings for the VDDD, VDDA, and
//! VDDIO supplies
//!
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
// Includes and external references
////////////////////////////////////////////////////////////////////////////////
#include "hw_power_common.h"

////////////////////////////////////////////////////////////////////////////////
// Variables
////////////////////////////////////////////////////////////////////////////////

//! This array maps bit numbers to current increments, as used in the register
//! fields HW_POWER_CHARGE.STOP_ILIMIT and HW_POWER_CHARGE.BATTCHRG_I.

                             // Bit: |0|  |1|  |2|  |3|  |4|  |5|
static const uint16_t  currentPerBit[] = {  10,  20,  50, 100, 200, 400 };

////////////////////////////////////////////////////////////////////////////////
// Code
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//! See hw_power.h for details.
////////////////////////////////////////////////////////////////////////////////
uint16_t  hw_power_ConvertCurrentToSetting(uint16_t u16Current)
{
    int       i;
    uint16_t  u16Mask;
    uint16_t  u16Setting = 0;

    // Scan across the bit field, adding in current increments.
    u16Mask = (0x1 << 5);

    for (i = 5; (i >= 0) && (u16Current > 0); i--, u16Mask >>= 1)
    {
        if (u16Current >= currentPerBit[i])
        {
            u16Current -= currentPerBit[i];
            u16Setting |= u16Mask;
        }
    }

    // Return the result.
    return(u16Setting);
}

////////////////////////////////////////////////////////////////////////////////
//! See hw_power.h for details.
////////////////////////////////////////////////////////////////////////////////
uint16_t  hw_power_ConvertSettingToCurrent(uint16_t u16Setting)
{
    int       i;
    uint16_t  u16Mask;
    uint16_t  u16Current = 0;

    // Scan across the bit field, adding in current increments.
    u16Mask = (0x1 << 5);

    for (i = 5; i >= 0; i--, u16Mask >>= 1)
    {
        if (u16Setting & u16Mask) u16Current += currentPerBit[i];
    }

    // Return the result.
    return(u16Current);
}

////////////////////////////////////////////////////////////////////////////////
//! See hw_power.h for details.
////////////////////////////////////////////////////////////////////////////////
uint16_t hw_power_ConvertVdddToSetting(uint16_t u16Vddd)
{
    return ((u16Vddd - VDDD_BASE_MV)/25);
}

////////////////////////////////////////////////////////////////////////////////
//! See hw_power.h for details.
////////////////////////////////////////////////////////////////////////////////
uint16_t hw_power_ConvertSettingToVddd(uint16_t u16Setting)
{
    return ((u16Setting * 25) + VDDD_BASE_MV);
}

////////////////////////////////////////////////////////////////////////////////
//! See hw_power.h for details.
////////////////////////////////////////////////////////////////////////////////
uint16_t hw_power_ConvertVddaToSetting(uint16_t u16Vdda)
{
    return ((u16Vdda - VDDA_BASE_MV)/25);
}

////////////////////////////////////////////////////////////////////////////////
//! See hw_power.h for details.
////////////////////////////////////////////////////////////////////////////////
uint16_t hw_power_ConvertSettingToVdda(uint16_t u16Setting)
{
    return ((u16Setting * 25) + VDDA_BASE_MV);
}

////////////////////////////////////////////////////////////////////////////////
//! See hw_power.h for details.
////////////////////////////////////////////////////////////////////////////////
uint16_t hw_power_ConvertVddioToSetting(uint16_t u16Vddio)
{
    return ((u16Vddio - VDDIO_BASE_MV)/25);
}

////////////////////////////////////////////////////////////////////////////////
//! See hw_power.h for details.
////////////////////////////////////////////////////////////////////////////////
uint16_t hw_power_ConvertSettingToVddio(uint16_t u16Setting)
{
    return ((u16Setting * 25) + VDDIO_BASE_MV);
}

////////////////////////////////////////////////////////////////////////////////
// End of file
////////////////////////////////////////////////////////////////////////////////
//! @}


